# Security Rules - AI Assistant Custom Instructions

## Purpose

This directory contains SonarQube rules focused on **security vulnerabilities**. These rules detect code patterns that could be exploited by attackers, leading to data breaches, unauthorized access, or system compromise. Security rules are typically the highest priority in any codebase.

---

## Rules in This Category (10 Rules)

| Rule File | Key | Description |
|-----------|-----|-------------|
| `command-injection.json` | `command-injection` | OS command injection via unsanitized user input |
| `csrf-vulnerability.json` | `csrf-vulnerability` | Missing CSRF protection on state-changing operations |
| `hardcoded-credentials.json` | `hardcoded-credentials` | Hardcoded passwords, API keys, secrets, tokens |
| `insecure-deserialization.json` | `insecure-deserialization` | Unsafe deserialization leading to RCE |
| `insecure-random.json` | `insecure-random` | Predictable random number generators in security contexts |
| `path-traversal.json` | `path-traversal` | File path traversal (directory traversal) attacks |
| `sensitive-data-exposure.json` | `sensitive-data-exposure` | Logging/exposing PII, passwords, sensitive data |
| `sql-injection.json` | `sql-injection` | SQL injection via string concatenation |
| `weak-cryptography.json` | `weak-cryptography` | Weak/deprecated algorithms (MD5, SHA1, DES) |
| `xss-vulnerability.json` | `xss-vulnerability` | Cross-Site Scripting (XSS) vulnerabilities |

---

## Security Rule Requirements

### Mandatory Properties

All security rules in this directory MUST have:

```json
{
  "type": "VULNERABILITY",
  "severity": "BLOCKER" or "CRITICAL",
  "tags": ["security", ...]
}
```

### Severity Guidelines for Security Rules

| Severity | When to Use | Examples |
|----------|-------------|----------|
| `BLOCKER` | Immediate exploitation risk, critical data exposure | Hardcoded credentials, exposed secrets |
| `CRITICAL` | Exploitable vulnerabilities requiring prompt action | SQL injection, XSS, command injection, CSRF |

**Never use `MAJOR`, `MINOR`, or `INFO` for security vulnerabilities** - if the issue doesn't warrant `BLOCKER` or `CRITICAL`, it likely belongs in a different category.

### Required Tags

Always include these tags where applicable:

| Tag | When to Include |
|-----|-----------------|
| `security` | **Always** - all rules in this directory |
| `owasp-top-10` | Vulnerability is in OWASP Top 10 |
| `injection` | Any injection attack (SQL, command, LDAP, etc.) |
| `authentication` | Authentication/credential issues |
| `encryption` | Cryptography-related issues |
| `secrets` | Credential/secret exposure |
| `xss` | Cross-site scripting |
| `csrf` | Cross-site request forgery |

---

## Creating New Security Rules

### Template

```json
{
  "key": "vulnerability-name",
  "name": "Vulnerability Name Detection",
  "description": "Detects [specific vulnerability pattern] which can lead to [specific security impact]. Attackers can exploit this to [attack vector].",
  "severity": "CRITICAL",
  "type": "VULNERABILITY",
  "tags": ["security", "owasp-top-10", "specific-tag"],
  "remediation": {
    "constantCost": "30min",
    "examples": [
      {
        "before": "// Vulnerable code pattern",
        "after": "// Secure implementation"
      }
    ]
  },
  "impacts": [
    {
      "softwareQuality": "SECURITY",
      "severity": "HIGH"
    }
  ],
  "defaultSeverity": "CRITICAL",
  "status": "READY",
  "debt": {
    "function": "CONSTANT_ISSUE",
    "offset": "30min"
  }
}
```

### Checklist for New Security Rules

- [ ] `type` is `VULNERABILITY`
- [ ] `severity` is `BLOCKER` or `CRITICAL`
- [ ] `tags` includes `security`
- [ ] `tags` includes `owasp-top-10` if applicable
- [ ] Description explains the attack vector and potential impact
- [ ] Remediation example shows a secure alternative
- [ ] `impacts.softwareQuality` is `SECURITY`
- [ ] `impacts.severity` is `HIGH`

---

## Writing Effective Security Rule Descriptions

Security rule descriptions should answer:

1. **What is detected?** - The vulnerable code pattern
2. **Why is it dangerous?** - The security impact
3. **How can it be exploited?** - Attack vector overview
4. **What's the remediation?** - How to fix it securely

### Example Description

> "Detects potential SQL injection vulnerabilities where user input is directly concatenated into SQL queries without proper sanitization or parameterization. Attackers can manipulate these queries to access, modify, or delete database contents, or execute administrative operations."

---

## OWASP Top 10 Reference

When creating security rules, reference the relevant OWASP Top 10 category:

| OWASP Category | Related Rules |
|----------------|---------------|
| A01:2021 - Broken Access Control | `path-traversal`, `csrf-vulnerability` |
| A02:2021 - Cryptographic Failures | `weak-cryptography`, `hardcoded-credentials` |
| A03:2021 - Injection | `sql-injection`, `command-injection`, `xss-vulnerability` |
| A04:2021 - Insecure Design | `insecure-random` |
| A05:2021 - Security Misconfiguration | `sensitive-data-exposure` |
| A08:2021 - Software and Data Integrity Failures | `insecure-deserialization` |

---

## Remediation Time Estimates

| Vulnerability Type | Typical Remediation Time |
|-------------------|-------------------------|
| Hardcoded credentials | 15min (externalize to config/secrets manager) |
| SQL injection | 30min (implement parameterized queries) |
| XSS | 20min (implement output encoding) |
| Command injection | 30min (use safe APIs, input validation) |
| CSRF | 20min (implement token validation) |
| Weak cryptography | 30min (upgrade to secure algorithms) |
| Path traversal | 20min (canonicalize paths, validate input) |
| Insecure deserialization | 45min (implement safe deserialization) |
