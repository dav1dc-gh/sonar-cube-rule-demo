# Code Smells Rules - AI Assistant Custom Instructions

## Purpose

This directory contains SonarQube rules focused on **code smells**. Code smells are patterns that indicate potential design problems - they're not bugs per se, but they reduce code quality, increase technical debt, and make the codebase harder to maintain and extend. These rules enforce clean code principles and software design best practices.

---

## Rules in This Category (8 Rules)

| Rule File | Key | Description |
|-----------|-----|-------------|
| `complex-methods.json` | `complex-methods` | High cyclomatic complexity in methods |
| `dead-code.json` | `dead-code` | Unreachable code, unused variables/methods/classes |
| `duplicate-code.json` | `duplicate-code` | Code duplication (DRY violations) |
| `empty-catch-block.json` | `empty-catch-block` | Empty catch blocks swallowing exceptions |
| `feature-envy.json` | `feature-envy` | Methods overly dependent on other classes |
| `god-class.json` | `god-class` | Classes with too many responsibilities |
| `long-parameter-list.json` | `long-parameter-list` | Methods with excessive parameters |
| `magic-numbers.json` | `magic-numbers` | Unnamed numerical constants |

---

## Code Smell Rule Requirements

### Mandatory Properties

All code smell rules in this directory MUST have:

```json
{
  "type": "CODE_SMELL",
  "severity": "MAJOR" or "MINOR",
  "tags": ["code-smell", ...]
}
```

### Severity Guidelines for Code Smells

| Severity | When to Use | Examples |
|----------|-------------|----------|
| `MAJOR` | Significant design issues affecting maintainability | God class, complex methods, duplicate code, empty catch blocks |
| `MINOR` | Lower-impact issues, style/convention violations | Magic numbers, long parameter lists |

**Use `MAJOR` when** the smell significantly impacts:
- Code comprehension
- Modification safety
- Testing difficulty
- Team collaboration

**Use `MINOR` when** the smell is:
- A convention violation
- Low-impact on day-to-day development
- Easy to address but not urgent

---

## Design Principles to Reference

Code smell rules should connect to established design principles:

| Principle | Related Rules | Tag to Use |
|-----------|---------------|------------|
| **Single Responsibility Principle (SRP)** | `god-class`, `complex-methods` | `solid`, `srp` |
| **Don't Repeat Yourself (DRY)** | `duplicate-code` | `dry` |
| **Keep It Simple (KISS)** | `complex-methods`, `long-parameter-list` | `complexity` |
| **Law of Demeter** | `feature-envy` | `coupling` |
| **Clean Code** | All rules | `clean-code` |

### Required Tags

Always include these tags where applicable:

| Tag | When to Include |
|-----|-----------------|
| `code-smell` | **Always** - all rules in this directory |
| `design` | Design pattern or principle violations |
| `solid` | SOLID principle violations |
| `maintainability` | Impacts long-term maintenance |
| `readability` | Impacts code comprehension |
| `refactoring` | Rule suggests refactoring |
| `complexity` | Complexity-related issues |
| `error-handling` | Exception/error handling issues |

---

## Creating New Code Smell Rules

### Template

```json
{
  "key": "smell-name",
  "name": "Descriptive Smell Name",
  "description": "Detects [specific pattern] which indicates [design problem]. This makes the code [specific negative impact] and violates [design principle if applicable].",
  "severity": "MAJOR",
  "type": "CODE_SMELL",
  "tags": ["code-smell", "design", "maintainability"],
  "remediation": {
    "constantCost": "30min",
    "examples": [
      {
        "before": "// Code exhibiting the smell",
        "after": "// Refactored clean code"
      }
    ]
  },
  "impacts": [
    {
      "softwareQuality": "MAINTAINABILITY",
      "severity": "MEDIUM"
    }
  ],
  "defaultSeverity": "MAJOR",
  "status": "READY",
  "debt": {
    "function": "CONSTANT_ISSUE",
    "offset": "30min"
  }
}
```

### Template with Configurable Parameters

For rules with thresholds (like line counts or complexity limits):

```json
{
  "key": "threshold-based-smell",
  "name": "Threshold-Based Smell",
  "description": "Detects when [metric] exceeds acceptable limits.",
  "severity": "MAJOR",
  "type": "CODE_SMELL",
  "tags": ["code-smell", "complexity"],
  "debt": {
    "function": "LINEAR",
    "coefficient": "10min",
    "offset": "0min"
  },
  "params": [
    {
      "key": "max",
      "name": "Maximum Allowed",
      "description": "Maximum allowed value for this metric",
      "defaultValue": "100",
      "type": "INTEGER"
    }
  ]
}
```

### Checklist for New Code Smell Rules

- [ ] `type` is `CODE_SMELL`
- [ ] `severity` is `MAJOR` or `MINOR`
- [ ] `tags` includes `code-smell`
- [ ] Description explains what pattern is detected and why it's problematic
- [ ] Remediation shows before/after refactoring
- [ ] `impacts.softwareQuality` is `MAINTAINABILITY`
- [ ] Consider if rule needs configurable `params` (thresholds)
- [ ] Use `LINEAR` debt function if fix time scales with issue scope

---

## Technical Debt Functions

### CONSTANT_ISSUE

Use when fix time is predictable regardless of scope:

```json
"debt": {
  "function": "CONSTANT_ISSUE",
  "offset": "15min"
}
```

**Examples:** Empty catch block (always ~10min), magic number (always ~5min)

### LINEAR

Use when fix time scales with the issue's magnitude:

```json
"debt": {
  "function": "LINEAR",
  "coefficient": "10min",
  "offset": "0min"
}
```

**Examples:** God class (more methods = more time), duplicate code (more duplication = more time)

---

## Writing Effective Code Smell Descriptions

Code smell descriptions should answer:

1. **What is detected?** - The specific code pattern
2. **Why is it a smell?** - Design principle violated
3. **What's the impact?** - How it affects maintainability
4. **How to fix?** - General refactoring approach

### Example Description

> "Detects classes that have grown too large and handle too many responsibilities, violating the Single Responsibility Principle and making the code difficult to understand and maintain. Large classes should be split into smaller, focused classes."

---

## Remediation Time Estimates

| Code Smell | Typical Remediation Time |
|------------|-------------------------|
| Magic numbers | 5min (extract to named constant) |
| Empty catch block | 10min (add logging or proper handling) |
| Long parameter list | 15min (introduce parameter object) |
| Duplicate code | 30min (extract to shared method/class) |
| Complex methods | 30min (extract methods, simplify logic) |
| Feature envy | 30min (move method to appropriate class) |
| Dead code | 15min (remove safely with tests) |
| God class | 4h (major refactoring to split class) |

---

## Common Refactoring Patterns

When suggesting remediation, reference these patterns:

| Smell | Refactoring Pattern |
|-------|---------------------|
| God class | Extract Class, Move Method |
| Long method | Extract Method, Replace Temp with Query |
| Feature envy | Move Method, Extract Class |
| Long parameter list | Introduce Parameter Object, Preserve Whole Object |
| Duplicate code | Extract Method, Pull Up Method, Form Template Method |
| Magic numbers | Replace Magic Number with Symbolic Constant |
| Empty catch block | Add logging, Re-throw, Handle specifically |
